(this["webpackJsonpvoxel-edit"]=this["webpackJsonpvoxel-edit"]||[]).push([[0],{297:function(e,t,o){},302:function(e,t,o){},303:function(e,t,o){},304:function(e,t,o){},311:function(e,t,o){},420:function(e,t,o){"use strict";o.r(t);o(296),o(297);var n=o(0),r=o.n(n),a=o(46),l=o.n(a),i=(o(302),o(3)),c=o(6),s=o(7),d=o(8),u=o(88),h=(o(303),o(304),o(2)),p=function(e){Object(s.a)(o,e);var t=Object(d.a)(o);function o(e){var n;return Object(i.a)(this,o),(n=t.call(this,e)).canvasRef=r.a.createRef(),n}return Object(c.a)(o,[{key:"componentDidMount",value:function(){this.props.callbacks.onCanvasCreation(this.canvasRef)}},{key:"render",value:function(){return Object(h.jsx)("canvas",{className:"viewportCanvas",ref:this.canvasRef})}}]),o}(r.a.Component),b=o(470),j=function(e){Object(s.a)(o,e);var t=Object(d.a)(o);function o(e){var n;Object(i.a)(this,o),(n=t.call(this,e)).handleBrushClick=function(e,t){var o=t.name;n.setState({activeBrushAction:o}),n.props.callbacks.onBrushActionChange(o)};var r=n.props.callbacks.onGetBrushAction();return n.state={activeBrushAction:r},n}return Object(c.a)(o,[{key:"componentDidMount",value:function(){var e=this.props.callbacks.onGetBrushAction();this.setState({activeBrushAction:e})}},{key:"render",value:function(){var e=this.state.activeBrushAction;return Object(h.jsxs)(r.a.Fragment,{children:[Object(h.jsx)(b.a.Item,{name:"add",active:"add"===e,onClick:this.handleBrushClick,children:"Add Voxel"}),Object(h.jsx)(b.a.Item,{name:"remove",active:"remove"===e,onClick:this.handleBrushClick,children:"Remove Voxel"}),Object(h.jsx)(b.a.Item,{name:"paint",active:"paint"===e,onClick:this.handleBrushClick,children:"Paint Voxel"})]})}}]),o}(r.a.Component),v=function(e){Object(s.a)(o,e);var t=Object(d.a)(o);function o(e){var n;Object(i.a)(this,o),(n=t.call(this,e)).handleBrushClick=function(e,t){var o=t.name;n.setState({activeBrushType:o}),n.props.callbacks.onBrushTypeChange(o)};var r=n.props.callbacks.onGetBrushType();return n.state={activeBrushType:r},n}return Object(c.a)(o,[{key:"componentDidMount",value:function(){var e=this.props.callbacks.onGetBrushType();this.setState({activeBrushType:e})}},{key:"render",value:function(){var e=this.state.activeBrushType;return Object(h.jsxs)(r.a.Fragment,{children:[Object(h.jsx)(b.a.Item,{name:"single",active:"single"===e,onClick:this.handleBrushClick,children:"Single Voxel"}),Object(h.jsx)(b.a.Item,{name:"extrude",active:"extrude"===e,onClick:this.handleBrushClick,children:"Extrude Voxel"})]})}}]),o}(r.a.Component),x=o(469),f=o(472),m=o(459),O=function(e){Object(s.a)(o,e);var t=Object(d.a)(o);function o(e){var n;return Object(i.a)(this,o),(n=t.call(this,e)).handleInputChange=function(e){var t=e.target.value;(t=t.trim()).length<=n.maxNameLength&&n.setState({inputValue:t})},n.onSubmit=function(){n.props.onSubmit(n.state.inputValue)},n.createModal=function(){var e=0===n.state.inputValue.length;return Object(h.jsxs)(f.a,{onClose:n.props.onClose,onOpen:n.props.onOpen,open:n.props.open,closeIcon:!0,size:"mini",children:[Object(h.jsx)(f.a.Header,{children:n.props.header}),Object(h.jsx)(f.a.Content,{children:Object(h.jsx)(m.a,{action:{content:n.props.submit,disabled:e,onClick:n.onSubmit},fluid:!0,value:n.state.inputValue,onChange:n.handleInputChange,error:e,placeholder:n.props.placeholder})})]})},n.state={inputValue:""},n.maxNameLength=100,n}return Object(c.a)(o,[{key:"render",value:function(){return this.createModal()}}]),o}(r.a.Component),C=o(139),g=o.n(C),y=function(e){Object(s.a)(o,e);var t=Object(d.a)(o);function o(e){var n;return Object(i.a)(this,o),(n=t.call(this,e)).handleSaveProject=function(e){if(0!==e.length){var t=JSON.stringify(n.props.callbacks.onGetProjectData()),o=new Blob([t],{type:"application/json"});g.a.saveAs(o,e+".json"),n.setState({isSaveModalOpen:!1})}},n.onLoadProject=function(){n.loadFileInput.click()},n.handleFileSelected=function(e){var t=n.loadFileInput.files[0];if(t){n.loadFileReader.readAsText(t);var o=t.name.replace(/(.json)$/,"");n.setState({saveInputValue:o}),n.loadFileInput.value=""}},n.handleFileRead=function(e){var t=JSON.parse(e.target.result);n.props.callbacks.onLoadProjectData(t)},n.createExportModal=function(){return Object(h.jsx)(O,{onClose:function(){return n.setState({isExportModalOpen:!1})},onOpen:function(){return n.setState({isExportModalOpen:!0})},open:n.state.isExportModalOpen,onSubmit:n.onExportModel,header:"Export Model As...",submit:"Export .".concat(n.state.exportType),placeholder:"Enter export name..."})},n.createSaveModal=function(){return Object(h.jsx)(O,{onClose:function(){return n.setState({isSaveModalOpen:!1})},onOpen:function(){return n.setState({isSaveModalOpen:!0})},open:n.state.isSaveModalOpen,onSubmit:n.handleSaveProject,header:"Save Project As...",submit:"Save Project",placeholder:"Enter project name..."})},n.createExportSubMenu=function(){return Object(h.jsx)(x.a,{text:"Export",pointing:"left",className:"link item",children:Object(h.jsxs)(x.a.Menu,{children:[Object(h.jsx)(x.a.Item,{onClick:function(){return n.setState({isExportModalOpen:!0,exportType:"dae"})},children:"Collada (.dae)"}),Object(h.jsx)(x.a.Item,{onClick:function(){return n.setState({isExportModalOpen:!0,exportType:"ply"})},children:"Stanford (.ply)"}),Object(h.jsx)(x.a.Item,{onClick:function(){return n.setState({isExportModalOpen:!0,exportType:"stl"})},children:"Stl (.stl)"}),Object(h.jsx)(x.a.Item,{onClick:function(){return n.setState({isExportModalOpen:!0,exportType:"obj"})},children:"Wavefront (.obj)"})]})})},n.onExportModel=function(e){n.props.callbacks.onExportModel(e,n.state.exportType),n.setState({isExportModalOpen:!1})},n.state={isSaveModalOpen:!1,isExportModalOpen:!1,exportType:""},n.loadFileInput=document.createElement("input"),n.loadFileInput.type="file",n.loadFileInput.accept=".json",n.loadFileInput.addEventListener("change",n.handleFileSelected),n.loadFileReader=new FileReader,n.loadFileReader.addEventListener("load",n.handleFileRead),n}return Object(c.a)(o,[{key:"render",value:function(){var e=this;return Object(h.jsxs)(r.a.Fragment,{children:[this.createSaveModal(),this.createExportModal(),Object(h.jsx)(x.a,{text:"File",pointing:!0,className:"link item",children:Object(h.jsxs)(x.a.Menu,{children:[Object(h.jsx)(x.a.Item,{onClick:this.props.callbacks.onNewProject,children:"New Project"}),Object(h.jsx)(x.a.Item,{onClick:function(){return e.setState({isSaveModalOpen:!0})},children:"Save Project"}),Object(h.jsx)(x.a.Item,{onClick:this.onLoadProject,children:"Load Project"}),this.createExportSubMenu()]})})]})}}]),o}(r.a.Component),k=function(e){Object(s.a)(o,e);var t=Object(d.a)(o);function o(e){var n;return Object(i.a)(this,o),(n=t.call(this,e)).onExportImage=function(e){0!==e.length&&(n.props.callbacks.onExportImage(e),n.setState({isExportModalOpen:!1}))},n.createExportImageModal=function(){return Object(h.jsx)(O,{onClose:function(){return n.setState({isExportModalOpen:!1})},onOpen:function(){return n.setState({isExportModalOpen:!0})},open:n.state.isExportModalOpen,onSubmit:n.onExportImage,header:"Export Image As...",submit:"Export Image",placeholder:"Enter image name..."})},n.state={isExportModalOpen:!1},n}return Object(c.a)(o,[{key:"render",value:function(){var e=this;return Object(h.jsxs)(r.a.Fragment,{children:[this.createExportImageModal(),Object(h.jsx)(x.a,{text:"Render",pointing:!0,className:"link item",children:Object(h.jsx)(x.a.Menu,{children:Object(h.jsx)(x.a.Item,{onClick:function(){return e.setState({isExportModalOpen:!0})},children:"Export Scene to Image"})})})]})}}]),o}(r.a.Component),S=o(460),w=function(e){Object(s.a)(o,e);var t=Object(d.a)(o);function o(e){var n;return Object(i.a)(this,o),(n=t.call(this,e)).handleLoadExample=function(e){var t="/voxel-edit/models/"+e+".json";n.setState({isLoading:!0}),fetch(t).then((function(e){return e.json()})).then(n.props.callbacks.onLoadProjectData).then((function(){return n.setState({isLoading:!1})}))},n.createExampleProjectMenu=function(){return n.exampleProjects.map((function(e){var t=e.name,o=e.filename;return Object(h.jsx)(x.a.Item,{onClick:function(){return n.handleLoadExample(o)},children:t},t)}))},n.createLoadScreen=function(){return Object(h.jsx)(f.a,{basic:!0,open:n.state.isLoading,children:Object(h.jsx)(S.a,{size:"massive",children:"Loading project..."})})},n.state={isLoading:!1},n.exampleProjects=[{name:"EarthBound",filename:"earthbound-voxel"},{name:"Red Mage",filename:"redmage"},{name:"Samus",filename:"samus-8bit"},{name:"Super Meat Boy",filename:"super-meat-boy"},{name:"Zombie",filename:"zombie-grave"}],n}return Object(c.a)(o,[{key:"render",value:function(){return Object(h.jsxs)(r.a.Fragment,{children:[this.createLoadScreen(),Object(h.jsx)(x.a,{text:"Examples",pointing:!0,className:"link item",children:Object(h.jsx)(x.a.Menu,{children:this.createExampleProjectMenu()})})]})}}]),o}(r.a.Component),M=o(102),E=function(){return Object(h.jsxs)(b.a.Item,{href:"https://github.com/kenny-designs/voxel-edit",target:"_blank",children:[Object(h.jsx)(M.a,{name:"github"}),"GitHub"]})},I=(o(311),o(274)),A=function(e){var t=e.color,o=e.id,n=e.isActive,r=t.getRGB255(),a=r.r,l=r.g,i=r.b;return Object(h.jsx)("div",{onClick:function(){e.onColorCellClick(o,{r:a,g:l,b:i})},className:"color-cell ".concat(n?"active":""),style:{backgroundColor:"rgb(".concat(a,", ").concat(l,", ").concat(i,")")}})},P=function(e){Object(s.a)(o,e);var t=Object(d.a)(o);function o(e){var n;Object(i.a)(this,o),(n=t.call(this,e)).updateColorData=function(){var e=n.props.callbacks.onGetColorData(),t=e.currentColor,o=e.selectedColorIndex,r=e.isColorsFull,a={};n.state.isColorsFull!==r&&(a.isColorsFull=r),n.state.selectedColorIndex!==o&&(a.selectedColorIndex=o);var l=n.state.currentColor,i=l.r,c=l.g,s=l.b;i===t.r&&c===t.g&&s===t.b||(a.currentColor=t),0!==Object.keys(a).length&&n.setState(a)},n.handlePickerChange=function(e){var t=e.rgb;n.props.callbacks.onSelectedColorChange(n.state.selectedColorIndex,t),n.updateColorData()},n.onColorCellClick=function(e,t){n.props.callbacks.onNewSelectedColor(e),n.updateColorData()},n.onAddCellClick=function(){n.props.callbacks.onAddColor(),n.updateColorData()},n.getColorCells=function(){var e=[];return n.props.callbacks.onGetColorData().colors.forEach((function(t,o){e.push(Object(h.jsx)(A,{id:o,onColorCellClick:n.onColorCellClick,color:t,isActive:o===n.state.selectedColorIndex},o))})),e},n.getAddColorCell=function(){return n.state.isColorsFull?null:Object(h.jsx)("div",{className:"color-cell add-cell-btn",onClick:n.onAddCellClick,children:Object(h.jsx)(M.a,{name:"plus"})})};var r=n.props.callbacks.onGetColorData(),a=r.currentColor,l=r.selectedColorIndex,c=r.isColorsFull;return n.state={currentColor:a,selectedColorIndex:l,isColorsFull:c},n}return Object(c.a)(o,[{key:"componentDidUpdate",value:function(){this.updateColorData()}},{key:"render",value:function(){return Object(h.jsxs)("div",{children:[Object(h.jsxs)("div",{className:"color-cell-container",children:[this.getColorCells(),this.getAddColorCell()]}),Object(h.jsx)(I.a,{color:this.state.currentColor,disableAlpha:!0,onChange:this.handlePickerChange})]})}}]),o}(r.a.Component),T=o(479),B=o(480),z=o(474),R=o(481),F=o(425),D=function(e){Object(s.a)(o,e);var t=Object(d.a)(o);function o(e){var n;return Object(i.a)(this,o),(n=t.call(this,e)).updateMobileState=function(){var e=window.innerWidth<768;n.setState({isMobile:e})},n.handleAccordionIndicesChange=function(e,t){var o=Object(u.a)({},n.state.desktop),r=o[t].activeAccordionIndices,a=r.indexOf(e);-1!==a?r.splice(a,1):r.push(e),n.setState({desktop:o})},n.createDesktopBrush=function(){var e=n.state.desktop.brushSettings;return Object(h.jsx)(T.a.Group,{children:Object(h.jsxs)(T.a,{inverted:!0,children:[Object(h.jsxs)(B.a,{as:"h4",inverted:!0,children:[Object(h.jsx)(M.a,{name:"paint brush"}),Object(h.jsxs)(B.a.Content,{children:["Brush Settings",Object(h.jsx)(B.a.Subheader,{children:"Add, remove, or paint voxels"})]})]}),Object(h.jsxs)(z.a,{inverted:!0,fluid:!0,exclusive:!1,children:[Object(h.jsx)(z.a.Title,{active:e.activeAccordionIndices.includes(0),content:"Brush Actions",index:0,onClick:function(e,t){n.handleAccordionIndicesChange(t.index,"brushSettings")}}),Object(h.jsx)(z.a.Content,{active:e.activeAccordionIndices.includes(0),children:Object(h.jsx)(b.a,{inverted:!0,vertical:!0,fluid:!0,children:Object(h.jsx)(j,{callbacks:n.props.callbacks.brush.brushActions})})})]}),Object(h.jsxs)(z.a,{inverted:!0,fluid:!0,exclusive:!1,children:[Object(h.jsx)(z.a.Title,{active:e.activeAccordionIndices.includes(1),content:"Brush Types",index:1,onClick:function(e,t){n.handleAccordionIndicesChange(t.index,"brushSettings")}}),Object(h.jsx)(z.a.Content,{active:e.activeAccordionIndices.includes(1),children:Object(h.jsx)(b.a,{inverted:!0,vertical:!0,fluid:!0,children:Object(h.jsx)(v,{callbacks:n.props.callbacks.brush.brushTypes})})})]})]})})},n.createDesktopColorPalette=function(){var e=n.state.desktop.colorPalette;return Object(h.jsx)(T.a.Group,{children:Object(h.jsxs)(T.a,{inverted:!0,children:[Object(h.jsxs)(B.a,{as:"h4",inverted:!0,children:[Object(h.jsx)(M.a,{name:"tint"}),Object(h.jsxs)(B.a.Content,{children:["Color Palette",Object(h.jsx)(B.a.Subheader,{children:"Select a color to paint with"})]})]}),Object(h.jsxs)(z.a,{inverted:!0,fluid:!0,exclusive:!1,children:[Object(h.jsx)(z.a.Title,{active:e.activeAccordionIndices.includes(0),content:"Color Selection",index:0,onClick:function(e,t){n.handleAccordionIndicesChange(t.index,"colorPalette")}}),Object(h.jsx)(z.a.Content,{active:e.activeAccordionIndices.includes(0),children:Object(h.jsx)(P,{callbacks:n.props.callbacks.colorPalette})})]})]})})},n.state={isMobile:!1,mobile:{isModalOpen:!1,modalContentType:""},desktop:{brushSettings:{activeAccordionIndices:[0,1]},colorPalette:{activeAccordionIndices:[0]}}},n}return Object(c.a)(o,[{key:"componentDidMount",value:function(){this.updateMobileState(),window.addEventListener("resize",this.updateMobileState)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.updateMobileState)}},{key:"createDesktopViewport",value:function(){return Object(h.jsx)(p,{callbacks:this.props.callbacks.viewport})}},{key:"createDesktopGUI",value:function(){return Object(h.jsxs)(R.a,{padded:!0,style:{height:"100vh"},children:[Object(h.jsx)(R.a.Row,{style:{paddingTop:"0",paddingBottom:"0"},children:Object(h.jsx)(R.a.Column,{children:Object(h.jsxs)(b.a,{inverted:!0,children:[Object(h.jsx)(y,{callbacks:this.props.callbacks.file}),Object(h.jsx)(k,{callbacks:this.props.callbacks.render}),Object(h.jsx)(w,{callbacks:this.props.callbacks.examples}),Object(h.jsx)(E,{})]})})}),Object(h.jsxs)(R.a.Row,{style:{height:"90%",paddingTop:"0",paddingBottom:"0"},children:[Object(h.jsxs)(R.a.Column,{width:3,style:{height:"100%",overflowY:"auto"},children:[this.createDesktopBrush(),this.createDesktopColorPalette()]}),Object(h.jsx)(R.a.Column,{width:13,style:{height:"100%"},children:this.createDesktopViewport()})]})]})}},{key:"createMobileModal",value:function(){var e=this;return Object(h.jsxs)(f.a,{className:"mobileModal",open:this.state.mobile.isModalOpen,onClose:function(){return e.setState((function(e){return{mobile:Object(u.a)(Object(u.a)({},e.mobile),{},{isModalOpen:!1})}}))},onOpen:function(){return e.setState((function(e){return{mobile:Object(u.a)(Object(u.a)({},e.mobile),{},{isModalOpen:!0})}}))},children:[this.createMobileModalContent(),Object(h.jsx)(f.a.Actions,{children:Object(h.jsx)(F.a,{onClick:function(){return e.setState((function(e){return{mobile:Object(u.a)(Object(u.a)({},e.mobile),{},{isModalOpen:!1})}}))},primary:!0,children:"Close"})})]})}},{key:"createMobileModalContent",value:function(){var e,t,o=this.state.mobile.modalContentType;switch(this.state.mobile.modalContentType){case"ColorPalette":e=Object(h.jsxs)(B.a,{as:"h4",children:[Object(h.jsx)(M.a,{name:"tint"}),Object(h.jsxs)(B.a.Content,{children:["Color Palette",Object(h.jsx)(B.a.Subheader,{children:"Select a color to paint with"})]})]}),t=Object(h.jsx)(P,{callbacks:this.props.callbacks.colorPalette});break;case"BrushSettings":e=Object(h.jsxs)(B.a,{as:"h4",children:[Object(h.jsx)(M.a,{name:"paint brush"}),Object(h.jsxs)(B.a.Content,{children:["Brush Settings",Object(h.jsx)(B.a.Subheader,{children:"Add, remove, or paint voxels"})]})]}),t=Object(h.jsxs)(b.a,{inverted:!0,vertical:!0,fluid:!0,children:[Object(h.jsx)(b.a.Item,{header:!0,children:"Brush Actions"}),Object(h.jsx)(j,{callbacks:this.props.callbacks.brush.brushActions}),Object(h.jsx)(b.a.Item,{header:!0,children:"Brush Types"}),Object(h.jsx)(v,{callbacks:this.props.callbacks.brush.brushTypes})]});break;default:e="Empty Modal",t="Nothing in here. Thr current modal type is '".concat(o,"'")}return Object(h.jsxs)(r.a.Fragment,{children:[Object(h.jsx)(f.a.Header,{children:e}),Object(h.jsx)(f.a.Content,{scrolling:!0,children:Object(h.jsx)(f.a.Description,{children:t})})]})}},{key:"createMobileGUI",value:function(){var e=this;return Object(h.jsxs)(r.a.Fragment,{children:[this.createMobileModal(),Object(h.jsxs)("div",{style:{height:window.innerHeight},children:[Object(h.jsxs)(b.a,{fixed:"top",inverted:!0,children:[Object(h.jsx)(y,{callbacks:this.props.callbacks.file}),Object(h.jsx)(k,{callbacks:this.props.callbacks.render}),Object(h.jsx)(w,{callbacks:this.props.callbacks.examples}),Object(h.jsx)(E,{})]}),Object(h.jsx)(p,{callbacks:this.props.callbacks.viewport}),Object(h.jsxs)(b.a,{fixed:"bottom",inverted:!0,style:{overflowX:"auto"},children:[Object(h.jsx)(b.a.Item,{as:"a",onClick:function(){return e.setState({mobile:{isModalOpen:!0,modalContentType:"BrushSettings"}})},children:"Brush Settings"}),Object(h.jsx)(b.a.Item,{as:"a",onClick:function(){return e.setState({mobile:{isModalOpen:!0,modalContentType:"ColorPalette"}})},children:"Color Palette"})]})]})]})}},{key:"render",value:function(){return this.state.isMobile?this.createMobileGUI():this.createDesktopGUI()}}]),o}(r.a.Component),G=o(32),V=o(12),N=o(271),L=o(267),q=o(268),W=o(270),H=o(269),U=o(84),Y=function(){function e(t){Object(i.a)(this,e),this.cellSize=t.cellSize,this.tileSize=t.tileSize,this.tileTextureWidth=t.tileTextureWidth,this.tileTextureHeight=t.tileTextureHeight,this.material=t.material,this.colorPalette=t.colorPalette,this.cellSliceSize=this.cellSize*this.cellSize,this.cells=t.cells,this.cellIdToMesh={},this.neighborOffsets=[[0,0,0],[-1,0,0],[1,0,0],[0,-1,0],[0,1,0],[0,0,-1],[0,0,1]]}return Object(c.a)(e,[{key:"computeVoxelOffset",value:function(e,t,o){var n=this.cellSize,r=this.cellSliceSize,a=0|V.h.euclideanModulo(e,n);return(0|V.h.euclideanModulo(t,n))*r+(0|V.h.euclideanModulo(o,n))*n+a}},{key:"computeCellId",value:function(e,t,o){var n=this.cellSize,r=Math.floor(e/n),a=Math.floor(t/n),l=Math.floor(o/n);return"".concat(r,",").concat(a,",").concat(l)}},{key:"addCellForVoxel",value:function(e,t,o){var n=this.computeCellId(e,t,o),r=this.cells[n];if(!r){var a=this.cellSize;r=new Uint8Array(a*a*a),this.cells[n]=r}return r}},{key:"getCellForVoxel",value:function(e,t,o){return this.cells[this.computeCellId(e,t,o)]}},{key:"setVoxel",value:function(e,t,o,n){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=this.getCellForVoxel(e,t,o);if(!a){if(!r)return;a=this.addCellForVoxel(e,t,o)}var l=this.computeVoxelOffset(e,t,o);a[l]=n}},{key:"getVoxel",value:function(e,t,o){var n=this.getCellForVoxel(e,t,o);return n?n[this.computeVoxelOffset(e,t,o)]:0}},{key:"floodFillVoxels",value:function(e,t,o,n,r,a,l,i){var c=this.getVoxel(e,t,o);if(i||c!==l)for(var s=[{x:e,y:t,z:o}];s.length;){var d=s.pop(),u=d.x,h=d.y,p=d.z;this.getVoxel(u,h,p)===c&&0===this.getVoxel(u+n,h+r,p+a)&&(i?this.setVoxel(u+n,h+r,p+a,l):this.setVoxel(u,h,p,l),n||(s.push({x:u+1,y:h,z:p}),s.push({x:u-1,y:h,z:p})),r||(s.push({x:u,y:h+1,z:p}),s.push({x:u,y:h-1,z:p})),a||(s.push({x:u,y:h,z:p+1}),s.push({x:u,y:h,z:p-1})))}}},{key:"generateGeometryDataForCell",value:function(t,o,n){for(var r=this.cellSize,a=this.tileSize,l=this.tileTextureWidth,i=this.tileTextureHeight,c=[],s=[],d=[],u=[],h=[],p=t*r,b=o*r,j=n*r,v=0;v<r;++v)for(var x=b+v,f=0;f<r;++f)for(var m=j+f,O=0;O<r;++O){var C=p+O,g=this.getVoxel(C,x,m);if(g){var y,k=g-1,S=Object(U.a)(e.faces);try{for(S.s();!(y=S.n()).done;){var w=y.value,M=w.dir,E=w.corners,I=w.uvRow;if(!this.getVoxel(C+M[0],x+M[1],m+M[2])){var A,P=c.length/3,T=Object(U.a)(E);try{for(T.s();!(A=T.n()).done;){var B=A.value,z=B.pos,R=B.uv;c.push(z[0]+O,z[1]+v,z[2]+f),s.push.apply(s,Object(G.a)(M)),d.push((k+R[0])*a/l,1-(I+1-R[1])*a/i);var F=this.colorPalette.getColorAtIndex(g-1);h.push(F.r,F.g,F.b)}}catch(D){T.e(D)}finally{T.f()}u.push(P,P+1,P+2,P+2,P+1,P+3)}}}catch(D){S.e(D)}finally{S.f()}}}return{positions:c,normals:s,uvs:d,indices:u,colors:h}}},{key:"intersectRay",value:function(e,t){var o=t.x-e.x,n=t.y-e.y,r=t.z-e.z,a=o*o+n*n+r*r,l=Math.sqrt(a);o/=l,n/=l,r/=l;for(var i=0,c=Math.floor(e.x),s=Math.floor(e.y),d=Math.floor(e.z),u=o>0?1:-1,h=n>0?1:-1,p=r>0?1:-1,b=Math.abs(1/o),j=Math.abs(1/n),v=Math.abs(1/r),x=u>0?c+1-e.x:e.x-c,f=h>0?s+1-e.y:e.y-s,m=p>0?d+1-e.z:e.z-d,O=b<1/0?b*x:1/0,C=j<1/0?j*f:1/0,g=v<1/0?v*m:1/0,y=-1;i<=l;){var k=this.getVoxel(c,s,d);if(k)return{position:[e.x+i*o,e.y+i*n,e.z+i*r],normal:[0===y?-u:0,1===y?-h:0,2===y?-p:0],voxel:k};O<C?O<g?(c+=u,i=O,O+=b,y=0):(d+=p,i=g,g+=v,y=2):C<g?(s+=h,i=C,C+=j,y=1):(d+=p,i=g,g+=v,y=2)}return null}},{key:"updateVoxelGeometry",value:function(e,t,o,n){var r,a={},l=Object(U.a)(this.neighborOffsets);try{for(l.s();!(r=l.n()).done;){var i=r.value,c=t+i[0],s=o+i[1],d=n+i[2],u=this.computeCellId(c,s,d);a[u]||(a[u]=!0,this.updateCellGeometry(e,c,s,d))}}catch(h){l.e(h)}finally{l.f()}}},{key:"updateCellGeometry",value:function(e,t,o,n){var r=this.cellSize,a=Math.floor(t/r),l=Math.floor(o/r),i=Math.floor(n/r),c=this.computeCellId(t,o,n),s=this.cellIdToMesh[c],d=s?s.geometry:new V.b,u=this.generateGeometryDataForCell(a,l,i),h=u.positions,p=u.normals,b=u.indices,j=u.colors;d.setAttribute("position",new V.a(new Float32Array(h),3));d.setAttribute("normal",new V.a(new Float32Array(p),3));d.setAttribute("color",new V.a(new Float32Array(j),3)),d.setIndex(b),d.computeBoundingSphere(),s||((s=new V.k(d,this.material)).name=c,this.cellIdToMesh[c]=s,e.add(s),s.position.set(a*r,l*r,i*r))}},{key:"updateWorldGeometry",value:function(e){var t=this,o=Object.keys(this.cells),n=/^(-?\d+),(-?\d+),(-?\d+)$/;o.forEach((function(o){var r=o.match(n),a=parseInt(r[1],10),l=parseInt(r[2],10),i=parseInt(r[3],10);t.updateCellGeometry(e,a*t.cellSize,l*t.cellSize,i*t.cellSize)}))}},{key:"removeAllCells",value:function(e){var t=this;Object.keys(this.cellIdToMesh).forEach((function(o){var n=t.cellIdToMesh[o];n.geometry.dispose(),e.remove(n)})),this.cellIdToMesh={},this.cells={}}}]),e}();Y.faces=[{uvRow:0,dir:[-1,0,0],corners:[{pos:[0,1,0],uv:[0,1]},{pos:[0,0,0],uv:[0,0]},{pos:[0,1,1],uv:[1,1]},{pos:[0,0,1],uv:[1,0]}]},{uvRow:0,dir:[1,0,0],corners:[{pos:[1,1,1],uv:[0,1]},{pos:[1,0,1],uv:[0,0]},{pos:[1,1,0],uv:[1,1]},{pos:[1,0,0],uv:[1,0]}]},{uvRow:1,dir:[0,-1,0],corners:[{pos:[1,0,1],uv:[1,0]},{pos:[0,0,1],uv:[0,0]},{pos:[1,0,0],uv:[1,1]},{pos:[0,0,0],uv:[0,1]}]},{uvRow:2,dir:[0,1,0],corners:[{pos:[0,1,1],uv:[1,1]},{pos:[1,1,1],uv:[0,1]},{pos:[0,1,0],uv:[1,0]},{pos:[1,1,0],uv:[0,0]}]},{uvRow:0,dir:[0,0,-1],corners:[{pos:[1,0,0],uv:[0,0]},{pos:[0,0,0],uv:[1,0]},{pos:[1,1,0],uv:[0,1]},{pos:[0,1,0],uv:[1,1]}]},{uvRow:0,dir:[0,0,1],corners:[{pos:[0,0,1],uv:[0,0]},{pos:[1,0,1],uv:[1,0]},{pos:[0,1,1],uv:[0,1]},{pos:[1,1,1],uv:[1,1]}]}];var X=Y,J=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"add",o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"single";Object(i.a)(this,e),this.setCurrentAction(t),this.setCurrentType(o)}return Object(c.a)(e,[{key:"getCurrentAction",value:function(){return this.currentAction}},{key:"setCurrentAction",value:function(t){var o=e.brushActions[t];o&&(this.currentAction=o)}},{key:"getCurrentType",value:function(){return this.currentType}},{key:"setCurrentType",value:function(t){var o=e.brushTypes[t];o&&(this.currentType=o)}}]),e}();J.brushActions={add:"add",remove:"remove",paint:"paint"},J.brushTypes={single:"single",extrude:"extrude"};var _=J,$=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Object(i.a)(this,e),this.colors=null,this.selectedColor=0,this.setNewColorsArray(t||[new Z(.5176,.7843,.0902)]),this.setSelectedColor(o),this.maxColors=128}return Object(c.a)(e,[{key:"restoreDefaults",value:function(){this.selectedColor=0,this.colors=[new Z(.5176,.7843,.0902)]}},{key:"setNewColorsArray",value:function(e){this.colors=e.map((function(e){var t=e.r,o=e.g,n=e.b;return new Z(t,o,n)}))}},{key:"addColor",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.isColorsFull()||(this.colors.push(new Z(e,t,o)),this.selectedColor=this.colors.length-1)}},{key:"isColorsFull",value:function(){return this.colors.length>=this.maxColors}},{key:"setColorAtIndex",value:function(e,t,o,n){e<0||e>=this.colors.length||(this.colors[e].r=t,this.colors[e].g=o,this.colors[e].b=n)}},{key:"getColorAtIndex",value:function(e){return e<0||e>=this.colors.length?null:this.colors[e]}},{key:"getSelectedColor",value:function(){return this.colors[this.selectedColor]}},{key:"setSelectedColor",value:function(e){if(e<0||e>=this.colors.length)return null;this.selectedColor=e}},{key:"getSelectedColorIndex",value:function(){return this.selectedColor}},{key:"getColorsArray",value:function(){return this.colors}}]),e}(),Z=function(){function e(t,o,n){Object(i.a)(this,e),this.r=t,this.g=o,this.b=n}return Object(c.a)(e,[{key:"getRGB255",value:function(){return{r:255*this.r,g:255*this.g,b:255*this.b}}}]),e}(),K=$;function Q(e,t,o,n,r){for(var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,l=t*r,i=o*r,c=n*r,s=0;s<r;++s)for(var d=0;d<r;++d)e.setVoxel(l+d,i,c+s,a)}var ee=function(){function e(t){var o=this;Object(i.a)(this,e),this.render=function(){o.renderRequested=void 0,o.resizeRendererToDisplaySize(o.renderer)&&(o.camera.aspect=o.canvas.clientWidth/o.canvas.clientHeight,o.camera.updateProjectionMatrix()),o.controls.update(),o.renderer.render(o.scene,o.camera)},this.requestRenderIfNotRequested=function(){o.renderRequested||(o.renderRequested=!0,requestAnimationFrame(o.render))},this.singleBrushAction=function(e){var t,n,r=o.brush.currentAction===_.brushActions.remove?0:o.world.colorPalette.getSelectedColorIndex()+1,a=e.position.map((function(t,n){return t+e.normal[n]*(o.brush.currentAction===_.brushActions.add?.5:-.5)}));(t=o.world).setVoxel.apply(t,Object(G.a)(a).concat([r])),(n=o.world).updateVoxelGeometry.apply(n,[o.scene].concat(Object(G.a)(a))),o.requestRenderIfNotRequested()},this.extrudeBrushAction=function(e){var t,n=o.brush.currentAction===_.brushActions.remove?0:o.world.colorPalette.getSelectedColorIndex()+1,r=e.position.map((function(t,o){return t+-.5*e.normal[o]})),a=o.brush.currentAction===_.brushActions.add;(t=o.world).floodFillVoxels.apply(t,Object(G.a)(r).concat(Object(G.a)(e.normal),[n,a])),o.world.updateWorldGeometry(o.scene),o.requestRenderIfNotRequested()},this.recordStartPosition=function(e){var t=o.mouse;t.x=e.clientX,t.y=e.clientY,t.moveX=0,t.moveY=0},this.recordMovement=function(e){var t=o.mouse;t.moveX+=Math.abs(t.x-e.clientX),t.moveY+=Math.abs(t.y-e.clientY)},this.placeVoxelIfNoMovement=function(e){var t=o.mouse;t.moveX<5&&t.moveY<5&&o.placeVoxel(e),window.removeEventListener("pointermove",o.recordMovement),window.removeEventListener("pointerup",o.placeVoxelIfNoMovement)},this.onSelectedColorChange=function(e,t,n,r){o.world.colorPalette.setColorAtIndex(e,t,n,r),o.world.updateWorldGeometry(o.scene),o.requestRenderIfNotRequested()},this.onNewSelectedColor=function(e){o.world.colorPalette.setSelectedColor(e)},this.onGetProjectData=function(){return{voxelWorld:{cellSize:o.world.cellSize,cells:o.world.cells},colorPalette:{colors:o.world.colorPalette.getColorsArray(),selectedColor:o.world.colorPalette.getSelectedColorIndex()}}},this.onLoadProjectData=function(e){var t=e.voxelWorld,n=e.colorPalette;o.world.removeAllCells(o.scene),o.world.colorPalette.setNewColorsArray(n.colors),o.world.colorPalette.setSelectedColor(n.selectedColor),o.world.cells=t.cells,o.world.cellSize=t.cellSize,o.world.updateWorldGeometry(o.scene),o.requestRenderIfNotRequested()},this.onExportImage=function(e){o.render(),o.canvas.toBlob((function(t){g.a.saveAs(t,e+".png")}),"image/png")},this.onExportModel=function(e,t){var n,r;switch(t){case"obj":n=new L.a,r="model/obj";break;case"ply":n=new q.a,r="text/plain";break;case"stl":n=new H.a,r="model/stl";break;case"dae":n=new W.a,r="model/vnd.collada+xml";break;default:n=null}if(n){var a=n.parse(o.scene),l=new Blob([a],{type:r});g.a.saveAs(l,e+"."+t)}},this.onNewProject=function(){o.world.removeAllCells(o.scene),o.world.colorPalette.restoreDefaults(),Q(o.world,0,0,0,o.cellSize,1),o.world.updateWorldGeometry(o.scene),o.requestRenderIfNotRequested()},this.canvas=t.canvas,this.renderer=new V.u({canvas:this.canvas,antialias:!0}),this.cellSize=32,this.createCamera(),this.createOrbitControls(),this.scene=new V.p,this.scene.background=new V.c("#3C3C3C"),this.addLight(-1,2,4),this.addLight(1,-1,-2);var n=new V.m({side:V.e,alphaTest:.1,transparent:!0,vertexColors:!0}),r=t.world,a=r?r.colorPalette:new K,l=r?r.cells:{};this.world=new X({cellSize:this.cellSize,tileSize:16,tileTextureWidth:256,tileTextureHeight:64,material:n,colorPalette:a,cells:l}),r||Q(this.world,0,0,0,this.cellSize,1),this.world.updateWorldGeometry(this.scene),this.renderRequested=!1,this.mouse={x:0,y:0,moveX:0,moveY:0},this.canvas.addEventListener("pointerdown",(function(e){e.preventDefault(),o.recordStartPosition(e),window.addEventListener("pointermove",o.recordMovement),window.addEventListener("pointerup",o.placeVoxelIfNoMovement)}),{passive:!1}),this.canvas.addEventListener("touchstart",(function(e){e.preventDefault()}),{passive:!1}),this.controls.addEventListener("change",this.requestRenderIfNotRequested),window.addEventListener("resize",this.requestRenderIfNotRequested),this.brush=new _,this.render()}return Object(c.a)(e,[{key:"createCamera",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:75,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e3;this.camera=new V.n(e,t,o,n),this.camera.position.set(.2*-this.cellSize,.3*this.cellSize,.2*-this.cellSize)}},{key:"createOrbitControls",value:function(){this.controls=new N.a(this.camera,this.canvas),this.controls.target.set(this.cellSize/2,0,this.cellSize/2),this.controls.update()}},{key:"addLight",value:function(e,t,o){var n=new V.d(16777215,1);n.position.set(e,t,o),this.scene.add(n)}},{key:"resizeRendererToDisplaySize",value:function(e){var t=e.domElement,o=t.clientWidth,n=t.clientHeight,r=t.width!==o||t.height!==n;return r&&e.setSize(o,n,!1),r}},{key:"getCanvasRelativePosition",value:function(e){var t=this.canvas,o=t.getBoundingClientRect();return{x:(e.clientX-o.left)*t.width/o.width,y:(e.clientY-o.top)*t.height/o.height}}},{key:"placeVoxel",value:function(e){var t=this.getCanvasRelativePosition(e),o=t.x/this.canvas.width*2-1,n=t.y/this.canvas.height*-2+1,r=new V.t,a=new V.t;r.setFromMatrixPosition(this.camera.matrixWorld),a.set(o,n,1).unproject(this.camera);var l=this.world.intersectRay(r,a);if(l)switch(this.brush.currentType){case _.brushTypes.single:this.singleBrushAction(l);break;case _.brushTypes.extrude:this.extrudeBrushAction(l)}}}]),e}(),te=function(e){Object(s.a)(o,e);var t=Object(d.a)(o);function o(e){var n;return Object(i.a)(this,o),(n=t.call(this,e)).createVoxelWorld=function(e){if(e)if(n.voxelEditor){var t=n.voxelEditor.world;n.voxelEditor=new ee({canvas:e.current,world:t})}else n.voxelEditor=new ee({canvas:e.current})},n.setBrushAction=function(e){n.voxelEditor&&n.voxelEditor.brush.setCurrentAction(e)},n.onGetBrushAction=function(){return n.voxelEditor?n.voxelEditor.brush.getCurrentAction():"add"},n.setBrushType=function(e){n.voxelEditor&&n.voxelEditor.brush.setCurrentType(e)},n.onGetBrushType=function(){return n.voxelEditor?n.voxelEditor.brush.getCurrentType():"single"},n.onGetColorData=function(){if(!n.voxelEditor)return{colors:[],selectedColorIndex:0,currentColor:{r:127.5,g:127.5,b:127.5},isColorsFull:!0};var e=n.voxelEditor.world.colorPalette,t=e.getSelectedColor().getRGB255(),o=t.r,r=t.g,a=t.b;return{colors:e.getColorsArray(),selectedColorIndex:e.getSelectedColorIndex(),currentColor:{r:o,g:r,b:a},isColorsFull:e.isColorsFull()}},n.onSelectedColorChange=function(e,t){if(n.voxelEditor){var o=t.r,r=t.g,a=t.b;n.voxelEditor.onSelectedColorChange(e,o/255,r/255,a/255)}},n.onNewSelectedColor=function(e){n.voxelEditor&&n.voxelEditor.onNewSelectedColor(e)},n.onAddColor=function(){n.voxelEditor&&n.voxelEditor.world.colorPalette.addColor()},n.onGetProjectData=function(){return n.voxelEditor?n.voxelEditor.onGetProjectData():{}},n.onLoadProjectData=function(e){n.voxelEditor&&(n.voxelEditor.onLoadProjectData(e),n.forceUpdate())},n.onExportImage=function(e){if(!n.voxelEditor)return null;n.voxelEditor.onExportImage(e)},n.onExportModel=function(e,t){n.voxelEditor&&n.voxelEditor.onExportModel(e,t)},n.onNewProject=function(){n.voxelEditor&&(n.voxelEditor.onNewProject(),n.forceUpdate())},n.getCallbacksObject=function(){return{brush:{brushActions:{onBrushActionChange:n.setBrushAction,onGetBrushAction:n.onGetBrushAction},brushTypes:{onBrushTypeChange:n.setBrushType,onGetBrushType:n.onGetBrushType}},colorPalette:{onGetColorData:n.onGetColorData,onSelectedColorChange:n.onSelectedColorChange,onNewSelectedColor:n.onNewSelectedColor,onAddColor:n.onAddColor},viewport:{onCanvasCreation:n.createVoxelWorld},file:{onGetProjectData:n.onGetProjectData,onLoadProjectData:n.onLoadProjectData,onExportModel:n.onExportModel,onNewProject:n.onNewProject},render:{onExportImage:n.onExportImage},examples:{onLoadProjectData:n.onLoadProjectData}}},n.voxelEditor=null,n.callbacks=n.getCallbacksObject(),n}return Object(c.a)(o,[{key:"render",value:function(){return Object(h.jsx)(D,{callbacks:this.callbacks})}}]),o}(r.a.Component),oe=o(24),ne=o(484),re=o(483),ae=o(485),le=o(482),ie=o(486),ce=o(475),se=o(473),de=o(468),ue=o(221),he=o.n(ue),pe=o(273),be=o.n(pe),je=o(96);function ve(){var e=n.useState(null),t=Object(oe.a)(e,2),o=t[0],r=t[1],a=n.useState(null),l=Object(oe.a)(a,2),i=l[0],c=l[1],s=Boolean(o),d=Boolean(i),u=function(){c(null)},p=function(){r(null),u()},b=Object(h.jsxs)(de.a,{anchorEl:o,anchorOrigin:{vertical:"top",horizontal:"right"},id:"primary-search-account-menu",keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:s,onClose:p,children:[Object(h.jsx)(se.a,{onClick:p,children:"Profile"}),Object(h.jsx)(se.a,{onClick:p,children:"My account"})]}),j="primary-search-account-menu-mobile",v=Object(h.jsxs)(de.a,{anchorEl:i,anchorOrigin:{vertical:"top",horizontal:"right"},id:j,keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:d,onClose:u,children:[Object(h.jsx)(se.a,{children:Object(h.jsx)(je.b,{style:function(e){return{color:e.isActive?"#02c692":""}},to:"/",children:"Home"})}),Object(h.jsx)(se.a,{children:Object(h.jsx)(le.a,{target:"_blank",href:"https://twitter.com/iotabots",size:"large","aria-label":"show 1 new tweets",color:"inherit",children:Object(h.jsx)(ce.a,{badgeContent:1,color:"error",children:Object(h.jsx)(he.a,{})})})})]});return Object(h.jsxs)(re.a,{sx:{flexGrow:1},children:[Object(h.jsx)(ne.a,{position:"static",children:Object(h.jsxs)(ae.a,{children:[Object(h.jsx)(ie.a,{variant:"h6",noWrap:!0,component:"div",sx:{display:{xs:"block",sm:"block"}},children:Object(h.jsx)(je.b,{className:"nav-link",to:"/",children:"IOTABOTS"})}),Object(h.jsx)(re.a,{sx:{flexGrow:1}}),Object(h.jsx)(re.a,{sx:{display:{xs:"none",md:"flex"}},children:Object(h.jsx)(je.b,{style:function(e){return{color:e.isActive?"#02c692":""}},className:"nav-link",to:"/",children:"Home"})}),Object(h.jsx)(re.a,{sx:{display:{xs:"none",md:"flex"}},children:Object(h.jsx)(le.a,{target:"_blank",href:"https://twitter.com/iotabots",size:"large","aria-label":"twitter",color:"inherit",children:Object(h.jsx)(ce.a,{badgeContent:1,color:"error",children:Object(h.jsx)(he.a,{})})})}),Object(h.jsx)(re.a,{sx:{display:{xs:"flex",md:"none"}},children:Object(h.jsx)(le.a,{size:"large","aria-label":"show more","aria-controls":j,"aria-haspopup":"true",onClick:function(e){c(e.currentTarget)},color:"inherit",children:Object(h.jsx)(be.a,{})})})]})}),v,b]})}var xe=o(487);function fe(){function e(){return Object(h.jsxs)(ie.a,{variant:"body2",color:"text.secondary",align:"center",children:["Copyright \xa9 ",Object(h.jsx)(xe.a,{color:"inherit",href:"/",children:"iotabots.io"})," ",(new Date).getFullYear(),"."]})}return Object(h.jsxs)(re.a,{sx:{bgcolor:"background.paper",p:6},component:"footer",children:[Object(h.jsx)(ie.a,{variant:"h6",align:"center",gutterBottom:!0,children:"*BEE* *BOB* *BOO*"}),Object(h.jsxs)(ie.a,{variant:"subtitle1",align:"center",color:"text.secondary",component:"p",children:["Follow us on ",Object(h.jsx)("a",{href:"https://twitter.com/iotabots",children:"Twitter"})]}),Object(h.jsx)(e,{})]})}var me=o(22),Oe=o(275),Ce=o(477),ge=function(){var e=Object(Oe.a)({typography:{fontFamily:"Press Start 2P"},palette:{primary:{light:"#757ce8",main:"#2b2b2b",dark:"#002884",contrastText:"#fff"},secondary:{light:"#ff7961",main:"#f44336",dark:"#ba000d",contrastText:"#000"}}});return Object(h.jsxs)(Ce.a,{theme:e,children:[Object(h.jsx)(ve,{}),Object(h.jsx)(me.c,{children:Object(h.jsx)(me.a,{path:"/",element:Object(h.jsx)(te,{})})}),Object(h.jsx)(fe,{})]})};l.a.render(Object(h.jsx)(je.a,{children:Object(h.jsx)(ge,{})}),document.getElementById("root"))}},[[420,1,2]]]);
//# sourceMappingURL=main.72e66edc.chunk.js.map